name: runner-smoke
on:
  workflow_dispatch: {}   # run it manually from the Actions tab

jobs:
  smoke:
    runs-on: [self-hosted]   # adjust label to match your runner
    steps:
      - name: Print runner basics
        run: |
          echo "Runner: $(hostname)"
          echo "User: $(whoami)"
          echo "OS: $(uname -a)"

      - name: Check Docker/Buildx
        run: |
          docker version || true
          docker buildx version || true

      - name: Install kubectl
        uses: azure/setup-kubectl@v4

      - name: Write kubeconfig
        run: |
          mkdir -p ~/.kube
          echo "${KUBE_CONFIG}" > ~/.kube/config
        env:
          KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }}

      - name: Check cluster access
        run: |
          kubectl version --short
          kubectl get nodes -o wide
